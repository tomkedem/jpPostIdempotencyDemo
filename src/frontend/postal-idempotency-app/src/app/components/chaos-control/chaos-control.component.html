<div class="chaos-root light-mode">
  <!-- Header -->
  <header class="chaos-header">
    <div class="logo-area">
      <mat-icon class="logo-icon">bolt</mat-icon>
      <span class="logo-title">בקרת כאוס</span>
    </div>
    <div class="header-center">
      <span
        class="status-badge"
        [ngClass]="idempotencyProtectionControl.value ? 'on' : 'off'"
      >
        <mat-icon>{{
          idempotencyProtectionControl.value ? "shield" : "warning"
        }}</mat-icon>
        {{ idempotencyProtectionControl.value ? "מוגן" : "לא מוגן" }}
      </span>
      <span class="header-clock">{{ getCurrentTime() }}</span>
    </div>
  </header>

  <!-- Main Content -->
  <main class="chaos-main">
    <section class="chaos-panels">
      <!-- Control Panel -->
      <div class="chaos-card control-card">
        <div class="card-header">
          <mat-icon class="card-icon">settings</mat-icon>
          <span class="card-title">הגדרות הגנה</span>
        </div>
        <div class="card-body">
          <div class="form-row">
            <label>הפעל הגנת אידמפוטנטיות</label>
            <mat-slide-toggle
              [formControl]="idempotencyProtectionControl"
              color="primary"
            >
              {{ idempotencyProtectionControl.value ? "פעיל" : "כבוי" }}
            </mat-slide-toggle>
          </div>
          <div class="form-row">
            <label>זמן תפוגה (שעות)</label>
            <input
              type="number"
              [formControl]="expirationHoursControl"
              min="1"
              max="168"
              placeholder="24"
            />
          </div>
        </div>
        <div class="card-actions">
          <button mat-raised-button color="primary" (click)="saveSettings()">
            <mat-icon>save</mat-icon> שמור
          </button>
        </div>
      </div>

      <!-- Metrics Panel -->
      <div class="chaos-card metrics-card">
        <div class="card-header">
          <mat-icon class="card-icon">bar_chart</mat-icon>
          <span class="card-title">מדדי ביצועים</span>
        </div>
        <div class="card-body metrics-body">
          <div class="metric-box">
            <mat-icon>trending_up</mat-icon>
            <div class="metric-value">
              {{ metrics()?.totalOperations || 0 }}
            </div>
            <div class="metric-label">סה"כ פעולות</div>
          </div>
          <div class="metric-box">
            <mat-icon>block</mat-icon>
            <div class="metric-value">
              {{ metrics()?.idempotentBlocks || 0 }}
            </div>
            <div class="metric-label">חסימות אידמפוטנט</div>
          </div>
          <div class="metric-box">
            <mat-icon>check_circle</mat-icon>
            <div class="metric-value">
              {{ metrics()?.successfulOperations || 0 }}
            </div>
            <div class="metric-label">פעולות מוצלחות</div>
          </div>
          <div class="metric-box">
            <mat-icon>percent</mat-icon>
            <div class="metric-value">{{ metrics()?.successRate || 0 }}%</div>
            <div class="metric-label">אחוז הצלחה</div>
          </div>
        </div>
      </div>
    </section>

    <section class="chaos-bottom">
      <!-- Guide Panel -->
      <div class="chaos-card guide-card">
        <div class="card-header">
          <mat-icon class="card-icon">menu_book</mat-icon>
          <span class="card-title">מדריך הגנה</span>
        </div>
        <div class="card-body guide-body">
          <ol class="guide-list">
            <li>
              הפעל את הגנת האידמפוטנטיות כדי למנוע כפילויות בפעולות קריטיות.
            </li>
            <li>קבע זמן תפוגה למפתחות אידמפוטנטיות.</li>
            <li>שלח בקשות עם כותרת <code>Idempotency-Key</code> ייחודית.</li>
            <li>בקשות חוזרות עם אותו מפתח יחסמו אוטומטית.</li>
            <li>עקוב אחר מדדי ההגנה בלוח הבקרה.</li>
          </ol>
        </div>
      </div>

      <!-- Terminal Panel -->
      <div class="chaos-card terminal-card">
        <div class="card-header">
          <mat-icon class="card-icon">terminal</mat-icon>
          <span class="card-title">יומן מערכת</span>
        </div>
        <div class="card-body terminal-body">
          <div class="log-line">
            <span class="timestamp">{{ getCurrentTime() }}</span>
            <span
              class="log-level"
              [ngClass]="
                idempotencyProtectionControl.value ? 'success' : 'warning'
              "
            >
              {{ idempotencyProtectionControl.value ? "מוגן" : "פגיע" }}
            </span>
            <span class="log-message">
              הגנת אידמפוטנטיות
              {{ idempotencyProtectionControl.value ? "פעילה" : "כבויה" }}
            </span>
          </div>
          <div class="log-line">
            <span class="timestamp">{{ getCurrentTime() }}</span>
            <span class="log-level info">הגדרות</span>
            <span class="log-message">
              זמן תפוגה: {{ expirationHoursControl.value || 24 }} שעות
            </span>
          </div>
          <div class="log-line">
            <span class="timestamp">{{ getCurrentTime() }}</span>
            <span class="log-level info">סטטיסטיקה</span>
            <span class="log-message">
              חסימות: {{ metrics()?.idempotentBlocks || 0 }} | הצלחות:
              {{ metrics()?.successfulOperations || 0 }} | אחוז הצלחה:
              {{ metrics()?.successRate || 0 }}%
            </span>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>
